# Package YAML Schema
# Schema for validating ACP package.yaml files
# Version: 1.0.0

schema_version: 1.0.0
description: Schema for ACP package.yaml files

# Required fields that must be present
required_fields:
  - name
  - version
  - description
  - author
  - license
  - repository

# Field definitions with validation rules
fields:
  name:
    type: string
    pattern: "^[a-z0-9-]+$"
    description: "Package name (lowercase, alphanumeric, hyphens only)"
    error_message: "Package name must be lowercase letters, numbers, and hyphens only"
    
  version:
    type: string
    pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    description: "Semantic version (X.Y.Z)"
    error_message: "Version must be in semantic versioning format (e.g., 1.0.0)"
    
  description:
    type: string
    min_length: 10
    max_length: 200
    description: "One-line package description"
    error_message: "Description must be between 10 and 200 characters"
    
  author:
    type: string
    min_length: 2
    description: "Package author name"
    error_message: "Author name must be at least 2 characters"
    
  license:
    type: string
    description: "License identifier (e.g., MIT, Apache-2.0)"
    error_message: "License must be specified"
    
  repository:
    type: string
    pattern: "^https?://.*\\.git$"
    description: "Git repository URL (must end with .git)"
    error_message: "Repository must be a valid git URL ending with .git"
    
  homepage:
    type: string
    pattern: "^https?://.*"
    required: false
    description: "Package homepage URL"
    error_message: "Homepage must be a valid HTTP/HTTPS URL"
    
  tags:
    type: array
    item_type: string
    required: false
    description: "Tags for package discovery"
    
  release:
    type: object
    required: false
    description: "Release configuration"
    fields:
      branch:
        type: string
        description: "Release branch name (e.g., main, master, mainline)"
      branches:
        type: array
        item_type: string
        required: false
        description: "Additional valid release branches"
    
  contents:
    type: object
    required: true
    description: "Package contents (patterns, commands, designs)"
    fields:
      patterns:
        type: array
        item_type: object
        required: false
        description: "List of pattern files (each with 'name' field)"
        item_fields:
          name:
            type: string
            required: true
            description: "Pattern filename (e.g., namespace.pattern-name.md)"
          description:
            type: string
            required: false
            description: "Pattern description"
          experimental:
            type: boolean
            required: false
            default: false
            description: "Mark as experimental (requires --experimental flag to install)"
      commands:
        type: array
        item_type: object
        required: false
        description: "List of command files (each with 'name' field)"
        item_fields:
          name:
            type: string
            required: true
            description: "Command filename (e.g., namespace.command-name.md)"
          description:
            type: string
            required: false
            description: "Command description"
          experimental:
            type: boolean
            required: false
            default: false
            description: "Mark as experimental (requires --experimental flag to install)"
      designs:
        type: array
        item_type: object
        required: false
        description: "List of design files (each with 'name' field)"
        item_fields:
          name:
            type: string
            required: true
            description: "Design filename (e.g., namespace.design-name.md)"
          description:
            type: string
            required: false
            description: "Design description"
          experimental:
            type: boolean
            required: false
            default: false
            description: "Mark as experimental (requires --experimental flag to install)"
      scripts:
        type: array
        item_type: object
        required: false
        description: "List of script files (each with 'name' field)"
        item_fields:
          name:
            type: string
            required: true
            pattern: "^[a-z0-9-]+\\.[a-z0-9-]+\\.sh$"
            description: "Script filename with namespace (e.g., namespace.script-name.sh)"
          description:
            type: string
            required: false
            description: "Script description"
          experimental:
            type: boolean
            required: false
            default: false
            description: "Mark as experimental (requires --experimental flag to install)"
    
  requires:
    type: object
    required: false
    description: "Compatibility requirements"
    fields:
      acp:
        type: string
        pattern: "^>=?[0-9]+\\.[0-9]+\\.[0-9]+$"
        description: "Minimum ACP version (e.g., >=2.0.0)"
      npm:
        type: object
        required: false
        description: "Required npm packages"
      pip:
        type: object
        required: false
        description: "Required Python packages"
      cargo:
        type: object
        required: false
        description: "Required Rust packages"
      go:
        type: object
        required: false
        description: "Required Go packages"

# Reserved package names that cannot be used
reserved_names:
  - acp
  - local
  - core
  - system
  - global
